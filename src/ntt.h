#ifndef NTT_H
#define NTT_H
#include <cmath>
#include "hls_vector.h"
#include "hls_stream.h"
#include "ap_int.h"
#include <tapa.h>

using Data = int;
constexpr int kVecLen = 64 / sizeof(Data);

using DataVec = tapa::vec_t<Data, kVecLen>;

template <typename T>
using bits = ap_uint<tapa::widthof<T>()>;

const int mod = 12289;

// Number of coefficients
constexpr int n = 1024;
constexpr int log2N = 10;

const int B = 8;
const int log2B = 3;

// WIDTH: number of coeffs processed in parallel (per NTT CORE)
const int WIDTH = 2*B;
const int DEPTH = n / (2*B);

const int spatial_stages = log2B + 1;
const int temporal_stages = log2N - (log2B + 1);

const int NUM_CH = 8;

const int NUM_CORE = kVecLen*NUM_CH / (2*B);

const int NUM_CH_PER_CORE = (2*B) / kVecLen; 


// Bit reversed array of twiddle factors
const int tw_factors[n] = {1, 1479, 8246, 5146, 4134, 6553, 11567, 1305, 5860, 3195, 1212, 10643, 3621, 9744, 8785, 3542, 7311, 10938, 8961, 5777, 5023, 6461, 5728, 4591, 3006, 9545, 563, 9314, 2625, 11340, 4821, 2639, 12149, 1853, 726, 4611, 11112, 4255, 2768, 1635, 2963, 7393, 2366, 9238, 9198, 12208, 11289, 7969, 8736, 4805, 11227, 2294, 9542, 4846, 9154, 8577, 9275, 3201, 7203, 10963, 1170, 9970, 955, 11499, 8340, 8993, 2396, 4452, 6915, 2837, 130, 7935, 11336, 3748, 6522, 11462, 5067, 10092, 12171, 9813, 8011, 1673, 5331, 7300, 10908, 9764, 4177, 8705, 480, 9447, 1022, 12280, 5791, 11745, 9821, 11950, 12144, 6747, 8652, 3459, 2731, 8357, 6378, 7399, 10530, 3707, 8595, 5179, 3382, 355, 4231, 2548, 9048, 11560, 3289, 10276, 9005, 9408, 5092, 10200, 6534, 4632, 4388, 1260, 334, 2426, 1428, 10593, 3400, 2399, 5191, 9153, 9273, 243, 3000, 671, 3531, 11813, 3985, 7384, 10111, 10745, 6730, 11869, 9042, 2686, 2969, 3978, 8779, 6957, 9424, 2370, 8241, 10040, 9405, 11136, 3186, 5407, 10163, 1630, 3271, 8232, 10600, 8925, 4414, 2847, 10115, 4372, 9509, 5195, 7394, 10805, 9984, 7247, 4053, 9644, 12176, 4919, 2166, 8374, 12129, 9140, 7852, 3, 1426, 7635, 10512, 1663, 8653, 4938, 2704, 5291, 5277, 1168, 11082, 9041, 2143, 11224, 11885, 4645, 4096, 11796, 5444, 2381, 10911, 1912, 4337, 11854, 4976, 10682, 11414, 8509, 11287, 5011, 8005, 5088, 9852, 8643, 9302, 6267, 2422, 6039, 2187, 2566, 10849, 8526, 9223, 27, 7205, 1632, 7404, 1017, 4143, 7575, 12047, 10752, 8585, 2678, 7270, 11744, 3833, 3778, 11899, 773, 5101, 11222, 9888, 442, 9377, 6591, 354, 7428, 5012, 2481, 1045, 9430, 10302, 10587, 8724, 11635, 7083, 5529, 9090, 12233, 6152, 4948, 400, 1728, 6427, 6136, 6874, 3643, 10930, 5435, 1254, 11316, 10256, 3998, 10367, 8410, 11821, 8301, 11907, 316, 6950, 5446, 6093, 3710, 7822, 4789, 7540, 5537, 3789, 147, 5456, 7840, 11239, 7753, 5445, 3860, 9606, 1190, 8471, 6118, 5925, 1018, 8775, 1041, 1973, 5574, 11011, 2344, 4075, 5315, 4324, 4916, 10120, 11767, 7210, 9027, 6281, 11404, 7280, 1956, 11286, 3532, 12048, 12231, 1105, 12147, 5681, 8812, 8851, 2844, 975, 4212, 8687, 6068, 421, 8209, 3600, 3263, 7665, 6077, 4782, 6403, 9260, 5594, 8076, 11785, 605, 9987, 5468, 1010, 787, 8807, 5241, 9369, 9162, 8120, 5057, 7591, 3445, 7509, 2049, 7377, 10968, 192, 431, 10710, 2505, 5906, 12138, 10162, 8332, 9450, 6415, 677, 6234, 3336, 12237, 9115, 1323, 2766, 3150, 1319, 8243, 709, 8049, 8719, 11454, 6224, 922, 11848, 8210, 1058, 1958, 7967, 10211, 11177, 64, 8633, 11606, 9830, 6507, 1566, 2948, 9786, 6370, 7856, 3834, 5257, 10542, 9166, 9235, 5486, 1404, 11964, 1146, 11341, 3728, 8240, 6299, 1159, 6099, 295, 5766, 11637, 8527, 2919, 8273, 8212, 3329, 7991, 9597, 168, 10695, 1962, 5106, 6328, 5297, 6170, 3956, 1360, 11089, 7105, 9734, 6167, 9407, 1805, 1954, 2051, 6142, 2447, 3963, 11713, 8855, 8760, 9381, 218, 9928, 10446, 9259, 4115, 5333, 10258, 5876, 2281, 156, 9522, 8320, 3991, 453, 6381, 11871, 8517, 4774, 6860, 4737, 1293, 10232, 5369, 9087, 7796, 350, 1512, 10474, 6906, 1489, 2500, 1583, 6347, 11026, 12240, 6374, 1483, 3009, 1693, 723, 174, 2738, 6421, 2655, 6554, 10314, 3757, 9364, 11942, 7535, 10431, 426, 3315, 1945, 1029, 1325, 5724, 3624, 1892, 8945, 6691, 5797, 8330, 10141, 5959, 1248, 2442, 5115, 7350, 1522, 2151, 3343, 4119, 12269, 7287, 7126, 7681, 9395, 8635, 1314, 1744, 5690, 9834, 338, 8342, 10347, 3408, 11124, 9714, 8778, 5478, 1178, 9513, 11783, 1255, 5784, 1392, 9615, 2212, 8951, 3276, 8122, 6085, 11251, 923, 2800, 12096, 10058, 6092, 11912, 7711, 375, 1620, 2185, 11897, 1836, 11864, 12109, 4138, 2689, 7684, 5509, 204, 7070, 10880, 2054, 2483, 3042, 1344, 11826, 3407, 3981, 1468, 11232, 9689, 9168, 4705, 5246, 4475, 1236, 9272, 11925, 2360, 9261, 7073, 6771, 11063, 4739, 4251, 622, 10552, 4499, 5672, 2947, 8307, 5609, 636, 7376, 8761, 4235, 8464, 3375, 2291, 7954, 3393, 512, 7619, 6825, 4906, 2900, 239, 11295, 4554, 1804, 1403, 6094, 5189, 10602, 11883, 146, 7021, 1518, 8524, 7226, 8113, 8022, 5653, 10014, 2461, 10533, 8144, 8755, 8328, 3495, 7725, 2065, 6463, 1131, 1445, 11164, 7429, 5734, 1176, 6781, 1275, 3889, 579, 6693, 6302, 3114, 9520, 6323, 12077, 8682, 10962, 8347, 7057, 7508, 7365, 11275, 11841, 60, 2717, 3200, 1535, 2260, 12221, 5836, 4566, 1417, 6613, 10032, 4505, 8314, 7406, 9202, 5835, 8545, 4963, 9233, 2528, 6444, 6701, 11877, 5102, 2450, 10584, 11873, 11475, 2164, 5416, 716, 2110, 3448, 11946, 7751, 10381, 11081, 7562, 5211, 1866, 6877, 8080, 6296, 9011, 5061, 1218, 11851, 3515, 3589, 11572, 2982, 10916, 4103, 9860, 1721, 1536, 1092, 5209, 9084, 3359, 4265, 3678, 10361, 11825, 8840, 11153, 8581, 9051, 9363, 10463, 7800, 9118, 8051, 11677, 3368, 4227, 4222, 1526, 12164, 11749, 1389, 2068, 346, 7885, 3163, 8257, 4840, 6162, 6320, 7640, 9360, 6026, 466, 1030, 8468, 1681, 8443, 1573, 3793, 6063, 2602, 1901, 11787, 7171, 11169, 2535, 5808, 21, 2873, 9462, 9855, 791, 11415, 9988, 6639, 170, 12139, 11641, 4289, 2307, 8, 11832, 4523, 4301, 8494, 3268, 6513, 10440, 10013, 982, 9696, 11410, 4390, 4218, 8835, 3758, 9332, 1481, 10243, 9349, 3317, 2532, 8957, 12150, 11759, 2626, 4504, 778, 8711, 4697, 1701, 8823, 1279, 11424, 2672, 7119, 3116, 189, 10526, 10080, 10939, 6457, 1734, 8474, 10595, 1530, 3869, 7866, 11129, 4820, 7771, 3094, 9559, 5411, 1868, 10036, 10506, 5078, 7315, 4565, 2478, 2840, 9270, 8095, 5275, 10499, 6879, 11038, 6164, 10407, 1040, 2035, 4665, 5406, 3020, 5673, 3669, 7002, 11345, 4770, 2643, 1095, 5781, 9244, 1241, 4378, 8838, 8195, 3840, 1842, 8176, 12217, 9461, 7937, 4834, 9577, 6828, 9343, 7779, 2637, 11408, 11924, 10362, 1015, 11385, 2485, 5039, 5547, 11009, 11675, 1371, 24, 1590, 4411, 11066, 9955, 10734, 10487, 7186, 10398, 2338, 4693, 9996, 417, 6138, 8820, 7846, 3418, 2622, 6903, 4661, 11779, 450, 1944, 11711, 5368, 3670, 8481, 7302, 9916, 7154, 12226, 4684, 8929, 10891, 9199, 11463, 7246, 8787, 6500, 1658, 6671, 4483, 6586, 1506, 3065, 910, 6389, 7570, 751, 10583, 8360, 3229, 7559, 1282, 3572, 2832, 10268, 6086, 5646, 9169, 6184, 3941, 3753, 5370, 3536, 769, 6763, 50, 216, 8484, 767, 10076, 8136, 8566, 11444, 10353, 12282, 7235, 9135, 9004, 7929, 5349, 9344, 2633, 10883, 4855, 3769, 9057, 293, 8190, 8345, 6685, 6759, 1265, 3007, 10118, 8809, 2941, 11722, 5289, 6627, 4273, 3221, 2595, 3837, 5082, 7699, 682, 980, 7087, 11445, 5207, 8239};

const int psi = tw_factors[n/2];

#endif // NTT_H